name: Verifica√ß√£o de Regras do Projeto

on:
  pull_request:
    branches: [ main, develop ]
  push:
    branches: [ main, develop ]

jobs:
  rules-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: Install dependencies
      run: npm ci
      
    - name: Verificar ESLint e TypeScript
      run: npm run rules:check
      
    - name: Verificar arquivos proibidos
      run: |
        echo "üîç Verificando arquivos com sufixos proibidos..."
        if find src -name "*_old*" -o -name "*-old*" -o -name "*Copia*" -o -name "*-copia*" -o -name "*:-copy*" -o -name "*backup*"; then
          echo "‚ùå ERRO: Encontrados arquivos com sufixos proibidos"
          exit 1
        fi
        echo "‚úÖ Nenhum arquivo proibido encontrado"
        
    - name: Verificar imports relativos
      run: |
        echo "üîç Verificando imports relativos em src/..."
        if grep -r "from '\.\./" src/ --include="*.ts" --include="*.tsx"; then
          echo "‚ùå ERRO: Encontrados imports relativos"
          echo "Use alias '@/path' em vez de '../' ou './'"
          exit 1
        fi
        echo "‚úÖ Nenhum import relativo encontrado"
        
    - name: Verificar uso de 'any'
      run: |
        echo "üîç Verificando uso de 'any'..."
        if grep -r ": any" src/ --include="*.ts" --include="*.tsx"; then
          echo "‚ùå ERRO: Encontrado uso de 'any'"
          echo "Use tipos espec√≠ficos ou 'unknown'"
          exit 1
        fi
        echo "‚úÖ Nenhum uso de 'any' encontrado"
        
    - name: Verificar tooltips hardcoded
      run: |
        echo "üîç Verificando tooltips hardcoded..."
        if grep -r "title=\"" src/ --include="*.tsx" | grep -v "tooltips\."; then
          echo "‚ùå ERRO: Encontrados tooltips hardcoded"
          echo "Use tooltips do dicion√°rio central src/i18n/tooltips.ts"
          exit 1
        fi
        echo "‚úÖ Nenhum tooltip hardcoded encontrado"
        
    - name: Verificar cabe√ßalhos de documenta√ß√£o
      run: |
        echo "üîç Verificando cabe√ßalhos de documenta√ß√£o..."
        for file in $(find src -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx"); do
          if ! head -5 "$file" | grep -q "Arquivo:"; then
            echo "‚ùå ERRO: Arquivo $file n√£o possui cabe√ßalho de documenta√ß√£o"
            exit 1
          fi
        done
        echo "‚úÖ Todos os arquivos possuem cabe√ßalho de documenta√ß√£o"
        
    - name: Verificar uso de componentes MUI padr√£o
      run: |
        echo "üîç Verificando uso de componentes MUI padr√£o..."
        if grep -r "ListItem.*button" src/ --include="*.tsx"; then
          echo "‚ùå ERRO: Encontrado uso de ListItem button (deprecated)"
          echo "Use ListItemButton em vez de ListItem button"
          exit 1
        fi
        echo "‚úÖ Apenas componentes MUI padr√£o encontrados"
        
    - name: Verificar internacionaliza√ß√£o
      run: |
        echo "üîç Verificando internacionaliza√ß√£o..."
        if grep -r "useMessages" src/ --include="*.tsx" | wc -l | grep -q "^0$"; then
          echo "‚ö†Ô∏è  AVISO: Nenhum uso de useMessages encontrado"
        else
          echo "‚úÖ Internacionaliza√ß√£o sendo usada corretamente"
        fi 